import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{d as Ye,f as me,E as Ze,e as $e,I as G,D as et,p as ve,q as tt,W as lt,r as nt,s as rt,t as pe}from"./ScrollFade-YiJdnYV-.js";import{S as at}from"./ShareButton-CzqLPjdz.js";import{F as it}from"./FullscreenButton-Bk-YQzX_.js";import"./i18n-IeFj-zpk.js";import{tick as ot,onMount as st}from"./svelte/svelte_svelte.js";import{M as ct,U as dt}from"./ModifyUpload-p1twvKjm.js";import{I as Z}from"./Image-Bdf4wQSw.js";import"./ImagePreview-C_QdZHnm.js";import{V as $}from"./Video-DZ7QGqqT.js";import{d as ut}from"./index-tFQomdd2.js";import{F as ft}from"./index-VELz1aW8.js";import{u as gt}from"./utils.svelte-NGrRZh7a.js";async function _t(U){return U?`<div style="display: flex; flex-wrap: wrap; gap: 16px">${(await Promise.all(U.map(async([x,_])=>x===null||!x.url?"":await gt(x.url)))).map(x=>`<img src="${x}" style="height: 400px" />`).join("")}</div>`:""}async function St(U,t,x="uploaded_file"){const _=U.type.split("/")[1]||"png",B=new File([U],`${x}.${_}`),K=[new ft({path:B.name,orig_name:B.name,blob:B,size:B.size,mime_type:B.type,is_stream:!1})];return await t(...K)}var mt=e.from_html('<div class="icon-button"><!></div>'),vt=e.from_html("<!> <!> <!> <!>",1),pt=e.from_html('<caption class="caption svelte-7anmrz"> </caption>'),ht=e.from_html("<!> <!>",1),bt=e.from_html("<button><!></button>"),wt=e.from_html('<span><!> <button class="media-button svelte-7anmrz" aria-label="detailed view of selected image"><!></button> <!> <div class="thumbnails scroll-hide svelte-7anmrz" data-testid="container_el"></div></span>'),yt=e.from_html("<!> <!> <!> <!>",1),xt=e.from_html("<!> <!>",1),kt=e.from_html('<div class="caption-label svelte-7anmrz"> </div>'),zt=e.from_html('<button class="delete-button svelte-7anmrz" aria-label="Delete image"><!></button>'),It=e.from_html('<div class="gallery-item svelte-7anmrz"><button><!> <!></button> <!></div>'),Pt=e.from_html('<div class="gallery-container"><!> <div><!> <div></div></div></div>'),Lt=e.from_html("<!> <!>",1);function Mt(U,t){e.push(t,!0);let x=e.prop(t,"show_label",3,!0),_=e.prop(t,"value",15),B=e.prop(t,"columns",19,()=>[2]),K=e.prop(t,"rows",3,void 0),V=e.prop(t,"height",3,"auto"),N=e.prop(t,"allow_preview",3,!0),he=e.prop(t,"object_fit",3,"cover"),be=e.prop(t,"show_share_button",3,!1),we=e.prop(t,"show_download_button",3,!1),r=e.prop(t,"selected_index",15),ye=e.prop(t,"show_fullscreen_button",3,!0),xe=e.prop(t,"fullscreen",3,!1),ke=e.prop(t,"root",3,""),ze=e.prop(t,"file_types",19,()=>["image","video"]),Ie=e.prop(t,"max_file_size",3,null),Pe=e.prop(t,"fit_columns",3,!0),Le=e.prop(t,"buttons",3,null),Me=e.prop(t,"oncustom_button_click",3,null),je=e.prop(t,"onpreview_open",3,()=>{}),Ee=e.prop(t,"onchange",3,()=>{}),Ue=e.prop(t,"onclear",3,()=>{}),Be=e.prop(t,"onselect",3,l=>{}),De=e.prop(t,"onshare",3,l=>{}),ee=e.prop(t,"onerror",3,l=>{}),te=e.prop(t,"onpreview_close",3,()=>{}),Re=e.prop(t,"onfullscreen",3,l=>{}),Te=e.prop(t,"ondelete",3,()=>{}),Fe=e.prop(t,"onupload",3,()=>{}),q=e.prop(t,"onsource_change",3,()=>{}),le=null,Q="normal",We=!1,Y=!1,ne,re=e.state(!1),d=e.derived(()=>_()==null?null:_().map(l=>"video"in l?{video:l.video,caption:l.caption}:"image"in l?{image:l.image,caption:l.caption}:{}));function Ae(l,i,u){if(l&&i&&u){const I=l.length;return Array.isArray(i)?i.map(h=>Math.min(h,I)):Math.min(i,I)}else return i}let Ce=e.derived(()=>Ae(e.get(d),B(),Pe())),ae=e.state(e.proxy(_()));r()==null&&t.preview&&_()?.length&&r(0);let ie=e.state(e.proxy(r()));e.user_effect(()=>{ut(e.get(ae),_())||(e.get(re)?(r(t.preview&&_()?.length?0:null),e.set(re,!1)):r()!==null&&_()!==null?r(Math.max(0,Math.min(r(),_().length-1))):r(null),Ee()(),e.set(ae,_(),!0))});let oe=e.derived(()=>((r()??0)+(e.get(d)?.length??0)-1)%(e.get(d)?.length??0)),se=e.derived(()=>((r()??0)+1)%(e.get(d)?.length??0));function Ge(l){const i=l.target,u=l.offsetX,h=i.offsetWidth/2;u<h?r(e.get(oe)):r(e.get(se))}function Oe(l){switch(l.code){case"Escape":l.preventDefault(),r(null),te()();break;case"ArrowLeft":l.preventDefault(),r(e.get(oe));break;case"ArrowRight":l.preventDefault(),r(e.get(se));break}}e.user_effect(()=>{r()!==e.get(ie)&&(e.set(ie,r(),!0),r()!==null&&(e.get(d)!=null&&r(Math.max(0,Math.min(r(),e.get(d).length-1))),Be()({index:r(),value:e.get(d)?.[r()]})))}),e.user_effect(()=>{N()&&e.get(p)&&Se(r())});let O=[],p=e.state(void 0);async function Se(l){if(typeof l!="number"||(await ot(),O[l]===void 0)||!e.get(p))return;O[l]?.focus();const{left:i,width:u}=e.get(p).getBoundingClientRect(),{left:I,width:h}=O[l].getBoundingClientRect(),M=I-i+h/2-u/2+e.get(p).scrollLeft;e.get(p)&&typeof e.get(p).scrollTo=="function"&&e.get(p).scrollTo({left:M<0?0:M,behavior:"smooth"})}async function Ve(l,i){let u;try{u=await t._fetch(l)}catch(M){if(M instanceof TypeError){window.open(l,"_blank","noreferrer");return}throw M}const I=await u.blob(),h=URL.createObjectURL(I),D=document.createElement("a");D.href=h,D.download=i,D.click(),URL.revokeObjectURL(h)}let m=e.derived(()=>r()!=null&&e.get(d)!=null?e.get(d)[r()]:null),ce=!1;function S(){e.get(p)&&(ce=e.get(p).scrollWidth>e.get(p).clientWidth)}st(()=>(S(),document.addEventListener("fullscreenchange",()=>{Y=!!document.fullscreenElement}),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S))),e.user_effect(()=>{e.get(d),S(),e.get(p)&&S()});function qe(l){if(!_()||!e.get(d))return;const i=e.get(d)[l];let u;"image"in i?u={file:i.image,index:l}:"video"in i&&(u={file:i.video,index:l}),u&&Te()(u)}let de=!1;var ue=Lt(),fe=e.first_child(ue);{var He=l=>{{let i=e.derived(()=>t.label||"Gallery");Ye(l,{get show_label(){return x()},get Icon(){return me},get label(){return e.get(i)}})}};e.if(fe,l=>{x()&&l(He)})}var Xe=e.sibling(fe,2);{var Je=l=>{Ze(l,{unpadded_box:!0,size:"large",children:(i,u)=>{me(i)},$$slots:{default:!0}})},Ke=l=>{var i=Pt(),u=e.child(i);{var I=k=>{var f=wt();e.set_class(f,1,"preview svelte-7anmrz",null,{},{minimal:Q==="minimal"});var P=e.child(f);$e(P,{display_top_corner:We,get buttons(){return Le()},get on_custom_button_click(){return Me()},children:(o,s)=>{var a=vt(),n=e.first_child(a);{var c=g=>{{let L=e.derived(()=>t.i18n("common.download"));G(g,{get Icon(){return et},get label(){return e.get(L)},onclick:()=>{const J="image"in e.get(m)?e.get(m)?.image:e.get(m)?.video;if(J==null)return;const{url:C,orig_name:Qe}=J;C&&Ve(C,Qe??"image")}})}};e.if(n,g=>{we()&&g(c)})}var v=e.sibling(n,2);{var b=g=>{it(g,{get fullscreen(){return xe()},onclick:L=>Re()({detail:L})})};e.if(v,g=>{ye()&&g(b)})}var A=e.sibling(v,2);{var y=g=>{var L=mt(),J=e.child(L);at(J,{get i18n(){return t.i18n},get value(){return e.get(d)},get formatter(){return _t},$$events:{share:C=>{De()(C)},error:C=>{ee()(C)}}}),e.reset(L),e.append(g,L)};e.if(A,g=>{be()&&g(y)})}var E=e.sibling(A,2);{var X=g=>{G(g,{get Icon(){return ve},label:"Close",onclick:()=>{r(null),te()()}})};e.if(E,g=>{Y||g(X)})}e.append(o,a)},$$slots:{default:!0}});var w=e.sibling(P,2),z=e.child(w);{var T=o=>{{let s=e.derived(()=>({alt:e.get(m).caption||"",title:e.get(m).caption||null,class:e.get(m).caption&&"with-caption",loading:"lazy"}));Z(o,{get restProps(){return e.get(s)},get src(){return e.get(m).image.url},data_testid:"detailed-image"})}},R=o=>{{let s=e.derived(()=>e.get(m).caption||"");$(o,{get src(){return e.get(m).video.url},"data-testid":"detailed-video",get alt(){return e.get(s)},loading:"lazy",loop:!1,is_stream:!1,muted:!1,controls:!0})}};e.if(z,o=>{"image"in e.get(m)?o(T):o(R,!1)})}e.reset(w);var F=e.sibling(w,2);{var W=o=>{var s=pt(),a=e.child(s,!0);e.reset(s),e.template_effect(()=>e.set_text(a,e.get(m).caption)),e.append(o,s)};e.if(F,o=>{e.get(m)?.caption&&o(W)})}var j=e.sibling(F,2);e.each(j,21,()=>e.get(d),e.index,(o,s,a)=>{var n=bt();let c;var v=e.child(n);{var b=y=>{{let E=e.derived(()=>({title:e.get(s).caption||null,alt:"",class:"with-caption",loading:"lazy"}));Z(y,{get src(){return e.get(s).image.url},get restProps(){return e.get(E)},data_testid:`thumbnail ${a+1}`})}},A=y=>{var E=ht(),X=e.first_child(E);pe(X);var g=e.sibling(X,2);{let L=e.derived(()=>e.get(s).caption||null);$(g,{get src(){return e.get(s).video.url},get title(){return e.get(L)},is_stream:!1,"data-testid":"thumbnail "+(a+1),alt:"",loading:"lazy",loop:!1})}e.append(y,E)};e.if(v,y=>{"image"in e.get(s)?y(b):y(A,!1)})}e.reset(n),e.bind_this(n,(y,E)=>O[E]=y,y=>O?.[y],()=>[a]),e.template_effect(()=>{c=e.set_class(n,1,"thumbnail-item thumbnail-small svelte-7anmrz",null,c,{selected:r()===a&&Q!=="minimal"}),e.set_attribute(n,"aria-label","Thumbnail "+(a+1)+" of "+e.get(d).length)}),e.event("click",n,()=>r(a)),e.append(o,n)}),e.reset(j),e.bind_this(j,o=>e.set(p,o),()=>e.get(p)),e.reset(f),e.template_effect(()=>{e.set_style(w,`height: calc(100% - ${e.get(m).caption?"80px":"60px"})`),e.set_style(j,`justify-content: ${ce?"flex-start":"center"};`)}),e.event("click",w,function(...o){("image"in e.get(m)?s=>Ge(s):null)?.apply(this,o)}),e.event("keydown",f,Oe),e.append(k,f)};e.if(u,k=>{e.get(m)&&N()&&k(I)})}var h=e.sibling(u,2);let D,M;var ge=e.child(h);{var Ne=k=>{ct(k,{get i18n(){return t.i18n},onclear:()=>{_([]),q()("upload"),Ue()()},children:(f,P)=>{var w=yt(),z=e.first_child(w);{var T=a=>{{let n=e.derived(()=>t.i18n("upload_text.click_to_upload"));G(a,{get Icon(){return tt},get label(){return e.get(n)},children:(c,v)=>{dt(c,{icon_upload:!0,onload:b=>Fe()(b),get filetype(){return ze()},file_count:"multiple",get max_file_size(){return Ie()},get root(){return ke()},onerror:b=>ee()(b),get stream_handler(){return t.stream_handler},get upload(){return t.upload},get upload_promise(){return le},set upload_promise(b){le=b},get uploading(){return de},set uploading(b){de=b}})},$$slots:{default:!0}})}};e.if(z,a=>{t.upload&&t.stream_handler&&a(T)})}var R=e.sibling(z,2);{var F=a=>{{let n=e.derived(()=>t.i18n("common.webcam"));G(a,{get Icon(){return lt},get label(){return e.get(n)},onclick:()=>{q()("webcam")}})}};e.if(R,a=>{t.sources.includes("webcam")&&a(F)})}var W=e.sibling(R,2);{var j=a=>{{let n=e.derived(()=>t.i18n("common.video"));G(a,{get Icon(){return nt},get label(){return e.get(n)},onclick:()=>{q()("webcam-video")}})}};e.if(W,a=>{t.sources.includes("webcam-video")&&a(j)})}var o=e.sibling(W,2);{var s=a=>{{let n=e.derived(()=>t.i18n("upload_text.paste_clipboard"));G(a,{get label(){return e.get(n)},onclick:()=>{q()("clipboard")},get Icon(){return rt}})}};e.if(o,a=>{t.sources.includes("clipboard")&&a(s)})}e.append(f,w)},$$slots:{default:!0}})};e.if(ge,k=>{t.interactive&&r()===null&&k(Ne)})}var H=e.sibling(ge,2);let _e;e.each(H,21,()=>e.get(d),e.index,(k,f,P)=>{var w=It(),z=e.child(w);let T;var R=e.child(z);{var F=n=>{{let c=e.derived(()=>e.get(f).caption||""),v=e.derived(()=>typeof e.get(f).image=="string"?e.get(f).image:e.get(f).image.url);Z(n,{get alt(){return e.get(c)},get src(){return e.get(v)},loading:"lazy"})}},W=n=>{var c=xt(),v=e.first_child(c);pe(v);var b=e.sibling(v,2);{let A=e.derived(()=>e.get(f).caption||null);$(b,{get src(){return e.get(f).video.url},get title(){return e.get(A)},is_stream:!1,"data-testid":"thumbnail "+(P+1),alt:"",loading:"lazy",loop:!1})}e.append(n,c)};e.if(R,n=>{"image"in e.get(f)?n(F):n(W,!1)})}var j=e.sibling(R,2);{var o=n=>{var c=kt(),v=e.child(c,!0);e.reset(c),e.template_effect(()=>e.set_text(v,e.get(f).caption)),e.append(n,c)};e.if(j,n=>{e.get(f).caption&&n(o)})}e.reset(z);var s=e.sibling(z,2);{var a=n=>{var c=zt(),v=e.child(c);ve(v),e.reset(c),e.event("click",c,e.stopPropagation(()=>qe(P))),e.append(n,c)};e.if(s,n=>{t.interactive&&n(a)})}e.reset(w),e.template_effect(()=>{T=e.set_class(z,1,"thumbnail-item thumbnail-lg svelte-7anmrz",null,T,{selected:r()===P}),e.set_attribute(z,"aria-label","Thumbnail "+(P+1)+" of "+e.get(d).length)}),e.event("click",z,()=>{r()===null&&N()&&je()(),r(P)}),e.append(k,w)}),e.reset(H),e.reset(h),e.reset(i),e.bind_this(i,k=>ne=k,()=>ne),e.template_effect(()=>{D=e.set_class(h,1,"grid-wrap svelte-7anmrz",null,D,{minimal:Q==="minimal","fixed-height":!V()||V()=="auto",hidden:Y}),M=e.set_style(h,"",M,{height:V()!=="auto"?V()+"px":null}),_e=e.set_class(H,1,"grid-container svelte-7anmrz",null,_e,{"pt-6":x()}),e.set_style(H,`--grid-cols:${e.get(Ce)??""}; --grid-rows:${K()??""}; --object-fit: ${he()??""};`)}),e.append(l,i)};e.if(Xe,l=>{_()==null||e.get(d)==null||e.get(d).length===0?l(Je):l(Ke,!1)})}e.bind_window_size("innerHeight",l=>l),e.append(U,ue),e.pop()}const Vt=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"}));export{Mt as G,Vt as a,St as h};
