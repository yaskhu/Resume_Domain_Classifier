import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{onMount as G,onDestroy as re,tick as fe}from"./svelte/svelte_svelte.js";import{I as Q,i as ae,a0 as he,a as pe,t as be,_ as we,d as ye,r as te,E as ke,e as xe,n as Ee,D as Te}from"./ScrollFade-YiJdnYV-.js";import{S as Le}from"./ShareButton-CzqLPjdz.js";import"./i18n-IeFj-zpk.js";import{f as Y,u as Ve}from"./utils.svelte-NGrRZh7a.js";import{b as Pe,t as De,V as Me}from"./Video-DZ7QGqqT.js";import"./svelte/svelte_internal_flags_legacy.js";import{M as Re}from"./ModifyUpload-p1twvKjm.js";import{V as Se}from"./VolumeLevels-CnHXisKY.js";import{p as Ie}from"./index-VELz1aW8.js";var Ae=e.from_html('<div class="load-wrap svelte-mctcyk"><span aria-label="loading timeline" class="loader svelte-mctcyk"></span></div>'),Ce=e.from_html('<img draggable="false" class="svelte-mctcyk"/>'),Be=e.from_html('<div id="timeline" class="thumbnail-wrapper svelte-mctcyk"><button aria-label="start drag handle for trimming video" class="handle left svelte-mctcyk"></button> <div class="opaque-layer svelte-mctcyk"></div> <!> <button aria-label="end drag handle for trimming video" class="handle right svelte-mctcyk"></button></div>'),Xe=e.from_html('<div class="container svelte-mctcyk"><!></div>');function Fe(X,t){e.push(t,!0);let a=e.prop(t,"videoElement",7),I=e.prop(t,"trimmedDuration",15,null),R=e.prop(t,"dragStart",15,0),_=e.prop(t,"dragEnd",15,0),h=e.prop(t,"loadingTimeline",15,!1),p=e.state(e.proxy([])),F=10,D,b=e.state(0),w=e.state(100),m=e.state(null);const E=i=>{e.set(m,i,!0)};let y=e.derived(()=>e.get(p).length!==F);e.user_effect(()=>{h(e.get(y))});const g=()=>{e.set(m,null)},M=(i,d)=>{if(e.get(m)){const f=document.getElementById("timeline");if(!f)return;const x=f.getBoundingClientRect();let s=(i.clientX-x.left)/x.width*100;if(d?s=e.get(m)==="left"?e.get(b)+d:e.get(w)+d:s=(i.clientX-x.left)/x.width*100,s=Math.max(0,Math.min(s,100)),e.get(m)==="left"){e.set(b,Math.min(s,e.get(w)),!0);const o=e.get(b)/100*D;a().currentTime=o,R(o)}else if(e.get(m)==="right"){e.set(w,Math.max(s,e.get(b)),!0);const o=e.get(w)/100*D;a().currentTime=o,_(o)}const v=e.get(b)/100*D,u=e.get(w)/100*D;I(u-v),e.set(b,e.get(b),!0),e.set(w,e.get(w),!0)}},r=i=>{if(e.get(m)){const d=1/D*100;i.key==="ArrowLeft"?M({clientX:0},-d):i.key==="ArrowRight"&&M({clientX:0},d)}},T=()=>{const i=document.createElement("canvas"),d=i.getContext("2d");if(!d)return;i.width=a().videoWidth,i.height=a().videoHeight,d.drawImage(a(),0,0,i.width,i.height);const f=i.toDataURL("image/jpeg",.7);e.set(p,[...e.get(p),f],!0)};G(()=>{const i=()=>{D=a().duration;const d=D/F;let f=0;const x=()=>{T(),f++,f<F?a().currentTime+=d:a().removeEventListener("seeked",x)};a().addEventListener("seeked",x),a().currentTime=0};a().readyState>=1?i():a().addEventListener("loadedmetadata",i)}),re(()=>{window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",g),window.removeEventListener("keydown",r)}),G(()=>{window.addEventListener("mousemove",M),window.addEventListener("mouseup",g),window.addEventListener("keydown",r)});var k=Xe(),L=e.child(k);{var S=i=>{var d=Ae();e.append(i,d)},A=i=>{var d=Be(),f=e.child(d);f.__mousedown=()=>E("left"),f.__keydown=u=>{(u.key==="ArrowLeft"||u.key=="ArrowRight")&&E("left")};var x=e.sibling(f,2),s=e.sibling(x,2);e.each(s,17,()=>e.get(p),e.index,(u,o,c)=>{var V=Ce();e.set_attribute(V,"alt",`frame-${c}`),e.template_effect(()=>e.set_attribute(V,"src",e.get(o))),e.append(u,V)});var v=e.sibling(s,2);v.__mousedown=()=>E("right"),v.__keydown=u=>{(u.key==="ArrowLeft"||u.key=="ArrowRight")&&E("right")},e.reset(d),e.template_effect(()=>{e.set_style(f,`left: ${e.get(b)??""}%;`),e.set_style(x,`left: ${e.get(b)??""}%; right: ${100-e.get(w)}%`),e.set_style(v,`left: ${e.get(w)??""}%;`)}),e.event("blur",f,g),e.event("blur",v,g),e.append(i,d)};e.if(L,i=>{e.get(y)?i(S):i(A,!1)})}e.reset(k),e.append(X,k),e.pop()}e.delegate(["mousedown","keydown"]);var He=e.from_html('<div class="timeline-wrapper svelte-1orxdv"><!></div>'),je=e.from_html('<time aria-label="duration of selected region in seconds"> </time> <div class="edit-buttons svelte-1orxdv"><button>Trim</button> <button>Cancel</button></div>',1),Oe=e.from_html('<div class="svelte-1orxdv"></div>'),Ue=e.from_html("<!> <!>",1),ze=e.from_html('<div><!> <div class="controls svelte-1orxdv" data-testid="waveform-controls"><!></div></div> <!>',1);function qe(X,t){e.push(t,!0);let a=e.prop(t,"videoElement",3,void 0),I=e.prop(t,"showRedo",3,!1),R=e.prop(t,"interactive",3,!0),_=e.prop(t,"mode",15,""),h=e.prop(t,"processingVideo",15,!1),p=e.prop(t,"value",3,null),F=e.prop(t,"show_download_button",3,!1),D=e.prop(t,"handle_clear",3,()=>{}),b=e.prop(t,"has_change_history",3,!1),w;G(async()=>{w=await Pe()}),e.user_effect(()=>{_()==="edit"&&e.get(m)===null&&a()&&e.set(m,a().duration,!0)});let m=e.state(null),E=e.state(0),y=e.state(0),g=e.state(!1);const M=()=>{_()==="edit"?(_(""),a()&&e.set(m,a().duration,!0)):_("edit")};var r=ze(),T=e.first_child(r);let k;var L=e.child(T);{var S=s=>{var v=He(),u=e.child(v);Fe(u,{get videoElement(){return a()},get dragStart(){return e.get(E)},set dragStart(o){e.set(E,o,!0)},get dragEnd(){return e.get(y)},set dragEnd(o){e.set(y,o,!0)},get trimmedDuration(){return e.get(m)},set trimmedDuration(o){e.set(m,o,!0)},get loadingTimeline(){return e.get(g)},set loadingTimeline(o){e.set(g,o,!0)}}),e.reset(v),e.append(s,v)};e.if(L,s=>{_()==="edit"&&a()&&s(S)})}var A=e.sibling(L,2),i=e.child(A);{var d=s=>{var v=je(),u=e.first_child(v);let o;var c=e.child(u,!0);e.reset(u);var V=e.sibling(u,2),B=e.child(V);let H;B.__click=()=>{a()&&(_(""),h(!0),De(w,e.get(E),e.get(y),a()).then(z=>{t.handle_trim_video(z)}).then(()=>{h(!1)}))};var P=e.sibling(B,2);let O;P.__click=M,e.reset(V),e.template_effect(z=>{o=e.set_class(u,1,"svelte-1orxdv",null,o,{hidden:e.get(g)}),e.set_text(c,z),H=e.set_class(B,1,"text-button svelte-1orxdv",null,H,{hidden:e.get(g)}),O=e.set_class(P,1,"text-button svelte-1orxdv",null,O,{hidden:e.get(g)})},[()=>Y(e.get(m))]),e.append(s,v)},f=s=>{var v=Oe();e.append(s,v)};e.if(i,s=>{_()==="edit"&&e.get(m)!==null?s(d):s(f,!1)})}e.reset(A),e.reset(T);var x=e.sibling(T,2);{let s=e.derived(()=>F()?p()?.url:null);Re(x,{get i18n(){return t.i18n},onclear:()=>D()(),get download(){return e.get(s)},children:(v,u)=>{var o=Ue(),c=e.first_child(o);{var V=P=>{{let O=e.derived(()=>h()||!b());Q(P,{get Icon(){return ae},label:"Reset video to initial value",get disabled(){return e.get(O)},onclick:()=>{t.handle_reset_value(),_("")}})}};e.if(c,P=>{I()&&_()===""&&P(V)})}var B=e.sibling(c,2);{var H=P=>{Q(P,{get Icon(){return he},label:"Trim video to selection",get disabled(){return h()},onclick:M})};e.if(B,P=>{R()&&_()===""&&P(H)})}e.append(v,o)},$$slots:{default:!0}})}e.template_effect(()=>k=e.set_class(T,1,"container svelte-1orxdv",null,k,{hidden:_()!=="edit"})),e.append(X,r),e.pop()}e.delegate(["click"]);var Ne=e.from_html('<input id="volume" class="volume-slider svelte-h4x5cd" type="range" min="0" max="1" step="0.01"/>');function We(X,t){e.push(t,!0);let a=e.prop(t,"current_volume",15,1),I=e.prop(t,"show_volume_slider",15,!1),R=e.state(void 0);G(()=>{_()});const _=()=>{let p=e.get(R);p&&(p.style.background=`linear-gradient(to right, white ${a()*100}%, rgba(255, 255, 255, 0.3) ${a()*100}%)`)};e.user_effect(()=>{a(),_()});var h=Ne();e.remove_input_defaults(h),h.__focusout=()=>I(!1),h.__input=p=>{p.target instanceof HTMLInputElement&&a(parseFloat(p.target.value))},e.bind_this(h,p=>e.set(R,p),()=>e.get(R)),e.template_effect(()=>e.set_value(h,a())),e.append(X,h),e.pop()}e.delegate(["focusout","input"]);var Ge=e.from_html('<track kind="captions" default/>'),Je=e.from_html('<div role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="full-screen"><!></div>'),Ke=e.from_html('<div class="wrap svelte-1k28h7x"><div><!></div> <div class="controls svelte-1k28h7x"><div class="inner svelte-1k28h7x"><span role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="play-pause-replay-button"><!></span> <span class="time svelte-1k28h7x"> </span>  <progress class="svelte-1k28h7x"></progress> <div class="volume-control-wrapper svelte-1k28h7x"><button class="icon volume-button svelte-1k28h7x" aria-label="Adjust volume"><!></button> <!></div> <!></div></div></div> <!>',1);function Qe(X,t){e.push(t,!0);let a=e.prop(t,"root",3,""),I=e.prop(t,"subtitle",3,null),R=e.prop(t,"label",3,"test"),_=e.prop(t,"interactive",3,!1),h=e.prop(t,"handle_change",3,()=>{}),p=e.prop(t,"handle_reset_value",3,()=>{}),F=e.prop(t,"is_stream",3,void 0),D=e.prop(t,"show_download_button",3,!1),b=e.prop(t,"value",3,null),w=e.prop(t,"handle_clear",3,()=>{}),m=e.prop(t,"has_change_history",3,!1),E=e.prop(t,"playback_position",15),y=e.state(0),g=e.state(0),M=e.state(!0),r=e.state(void 0),T=e.state(!1),k=e.state(!1),L=e.state(1),S=e.state(!1);function A(n){if(!e.get(g))return;if(n.type==="click"){d(n);return}if(n.type!=="touchmove"&&!(n.buttons&1))return;const l=n.type==="touchmove"?n.touches[0].clientX:n.clientX,{left:C,right:j}=n.currentTarget.getBoundingClientRect();e.set(y,e.get(g)*(l-C)/(j-C))}async function i(){e.get(r)&&document.fullscreenElement!=e.get(r)&&(e.get(r).currentTime>0&&!e.get(r).paused&&!e.get(r).ended&&e.get(r).readyState>e.get(r).HAVE_CURRENT_DATA?e.get(r).pause():await e.get(r).play())}function d(n){if(!e.get(g))return;const{left:l,right:C}=n.currentTarget.getBoundingClientRect();e.set(y,e.get(g)*(n.clientX-l)/(C-l))}function f(){t.onstop?.(),t.onend?.()}const x=async n=>{let l=new File([n],"video.mp4");const C=await Ie([l]);let j=(await t.upload(C,a()))?.filter(Boolean)[0];h()(j)};function s(){e.get(r)&&(e.get(S)?document.exitFullscreen():e.get(r).requestFullscreen())}function v(){e.set(S,document.fullscreenElement===e.get(r)),e.get(r)&&(e.get(r).controls=e.get(S))}let u=1,o;const c=.001;function V(){e.get(r)&&Math.abs(e.get(r).volume-u)>c&&(e.set(L,e.get(r).volume,!0),u=e.get(r).volume)}G(()=>(document.addEventListener("fullscreenchange",v),()=>{document.removeEventListener("fullscreenchange",v)})),re(()=>{e.get(r)&&e.get(r).removeEventListener("volumechange",V)}),e.user_effect(()=>{e.get(r)&&e.get(r)!==o&&(o&&o.removeEventListener("volumechange",V),e.get(r).addEventListener("volumechange",V),o=e.get(r))}),e.user_effect(()=>{E(e.get(y))}),e.user_effect(()=>{E()!==e.get(y)&&e.get(r)&&(e.get(r).currentTime=E())}),e.user_effect(()=>{e.get(r)&&!e.get(S)&&(Math.abs(e.get(r).volume-e.get(L))>c&&(e.get(r).volume=e.get(L),u=e.get(L)),e.get(r).controls=!1)}),e.user_effect(()=>{e.get(r)&&e.get(S)&&(u=e.get(r).volume)});var B=Ke(),H=e.first_child(B),P=e.child(H);let O;var z=e.child(P);{let n=e.derived(()=>`${R()}-player`);Me(z,{get src(){return t.src},preload:"auto",get autoplay(){return t.autoplay},get loop(){return t.loop},get is_stream(){return F()},get controls(){return e.get(S)},onclick:i,onplay:()=>t.onplay?.(),onpause:()=>t.onpause?.(),onerror:l=>t.onerror?.(l),onended:f,get"data-testid"(){return e.get(n)},get processingVideo(){return e.get(T)},onloadstart:()=>t.onloadstart?.(),onloadeddata:()=>t.onloadeddata?.(),onloadedmetadata:()=>t.onloadedmetadata?.(),get currentTime(){return e.get(y)},set currentTime(l){e.set(y,l,!0)},get duration(){return e.get(g)},set duration(l){e.set(g,l,!0)},get paused(){return e.get(M)},set paused(l){e.set(M,l,!0)},get node(){return e.get(r)},set node(l){e.set(r,l,!0)},children:(l,C)=>{var j=Ge();e.template_effect(()=>e.set_attribute(j,"src",I())),e.append(l,j)},$$slots:{default:!0}})}e.reset(P);var Z=e.sibling(P,2),$=e.child(Z),q=e.child($);q.__click=i,q.__keydown=i;var ne=e.child(q);{var le=n=>{ae(n)},ie=n=>{var l=e.comment(),C=e.first_child(l);{var j=U=>{be(U)},me=U=>{we(U)};e.if(C,U=>{e.get(M)?U(j):U(me,!1)},!0)}e.append(n,l)};e.if(ne,n=>{e.get(y)===e.get(g)?n(le):n(ie,!1)})}e.reset(q);var J=e.sibling(q,2),oe=e.child(J);e.reset(J);var N=e.sibling(J,2);N.__mousemove=A,N.__touchmove=n=>{n.preventDefault(),A(n)},N.__click=n=>{n.stopPropagation(),n.preventDefault(),d(n)};var K=e.sibling(N,2),W=e.child(K);W.__click=()=>e.set(k,!e.get(k));let ee;var se=e.child(W);Se(se,{get currentVolume(){return e.get(L)}}),e.reset(W);var de=e.sibling(W,2);{var ue=n=>{We(n,{get current_volume(){return e.get(L)},set current_volume(l){e.set(L,l,!0)},get show_volume_slider(){return e.get(k)},set show_volume_slider(l){e.set(k,l,!0)}})};e.if(de,n=>{e.get(k)&&n(ue)})}e.reset(K);var ce=e.sibling(K,2);{var ge=n=>{var l=Je();l.__click=s;var C=e.child(l);pe(C),e.reset(l),e.event("keypress",l,s),e.append(n,l)};e.if(ce,n=>{e.get(k)||n(ge)})}e.reset($),e.reset(Z),e.reset(H);var ve=e.sibling(H,2);{var _e=n=>{qe(n,{get videoElement(){return e.get(r)},showRedo:!0,handle_trim_video:x,get handle_reset_value(){return p()},get value(){return b()},get i18n(){return t.i18n},get show_download_button(){return D()},get handle_clear(){return w()},get has_change_history(){return m()},get processingVideo(){return e.get(T)},set processingVideo(l){e.set(T,l,!0)}})};e.if(ve,n=>{_()&&n(_e)})}e.template_effect((n,l)=>{O=e.set_class(P,1,"mirror-wrap svelte-1k28h7x",null,O,{mirror:t.mirror}),e.set_text(oe,`${n??""} / ${l??""}`),e.set_value(N,e.get(y)/e.get(g)||0),ee=e.set_style(W,"",ee,{color:e.get(k)?"var(--color-accent)":"white"})},[()=>Y(e.get(y)),()=>Y(e.get(g))]),e.append(X,B),e.pop()}e.delegate(["click","keydown","mousemove","touchmove"]);var Ye=e.from_html("<!> <!>",1),Ze=e.from_html('<!> <div data-testid="download-div"><!></div>',1),$e=e.from_html("<!> <!>",1);function et(X,t){e.push(t,!0);let a=e.prop(t,"value",15,null),I=e.prop(t,"subtitle",3,null),R=e.prop(t,"label",3,void 0),_=e.prop(t,"show_label",3,!0),h=e.prop(t,"buttons",3,null),p=e.prop(t,"on_custom_button_click",3,null),F=e.prop(t,"display_icon_button_wrapper_top_corner",3,!1),D=e.prop(t,"playback_position",15),b=e.state(null),w=e.state(null);e.user_effect(()=>{a()&&t.onchange?.(a())}),e.user_effect(()=>{async function r(){a()!==e.get(b)&&I()!==e.get(w)&&e.get(w)!==null&&(e.set(b,a(),!0),a(null),await fe(),a(e.get(b))),e.set(b,a(),!0),e.set(w,I())}r()});var m=$e(),E=e.first_child(m);{let r=e.derived(()=>R()||"Video");ye(E,{get show_label(){return _()},get Icon(){return te},get label(){return e.get(r)}})}var y=e.sibling(E,2);{var g=r=>{ke(r,{unpadded_box:!0,size:"large",children:(T,k)=>{te(T)},$$slots:{default:!0}})},M=r=>{var T=Ze(),k=e.first_child(T);e.key(k,()=>a().url,A=>{{let i=e.derived(()=>I()?.url);Qe(A,{get src(){return a().url},get subtitle(){return e.get(i)},get is_stream(){return a().is_stream},get autoplay(){return t.autoplay},onplay:()=>t.onplay?.(),onpause:()=>t.onpause?.(),onstop:()=>t.onstop?.(),onend:()=>t.onend?.(),onloadedmetadata:()=>{t.onload?.()},mirror:!1,get label(){return R()},get loop(){return t.loop},interactive:!1,get upload(){return t.upload},get i18n(){return t.i18n},get playback_position(){return D()},set playback_position(d){D(d)}})}});var L=e.sibling(k,2),S=e.child(L);{let A=e.derived(()=>h()??["download","share"]);xe(S,{get display_top_corner(){return F()},get buttons(){return e.get(A)},get on_custom_button_click(){return p()},children:(i,d)=>{var f=Ye(),x=e.first_child(f);{var s=o=>{{let c=e.derived(()=>a().is_stream?a().url?.replace("playlist.m3u8","playlist-file"):a().url),V=e.derived(()=>a().orig_name||a().path);Ee(o,{get href(){return e.get(c)},get download(){return e.get(V)},children:(B,H)=>{Q(B,{get Icon(){return Te},label:"Download"})},$$slots:{default:!0}})}};e.if(x,o=>{h()?.some(c=>typeof c=="string"&&c==="download")&&o(s)})}var v=e.sibling(x,2);{var u=o=>{Le(o,{get i18n(){return t.i18n},onerror:c=>t.onerror?.(c),onshare:c=>t.onshare?.(c),get value(){return a()},formatter:async c=>c?await Ve(c.data):""})};e.if(v,o=>{h()?.some(c=>typeof c=="string"&&c==="share")&&o(u)})}e.append(i,f)},$$slots:{default:!0}})}e.reset(L),e.append(r,T)};e.if(y,r=>{!a()||a().url===void 0?r(g):r(M,!1)})}e.append(X,m),e.pop()}const gt=Object.freeze(Object.defineProperty({__proto__:null,default:et},Symbol.toStringTag,{value:"Module"}));export{Qe as P,et as V,gt as a};
