import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{g as ye}from"./color-IAzuA1X-.js";import{onMount as xe}from"./svelte/svelte_svelte.js";import{q as ne}from"./i18n-IeFj-zpk.js";import{p as ae,B as we,e as Ee,d as Se,z as le,E as Ie}from"./ScrollFade-YiJdnYV-.js";import"./svelte/svelte_internal_flags_legacy.js";import{G as Be}from"./utils.svelte-NGrRZh7a.js";import{S as Le}from"./StreamingBar-CdRfiLdf.js";import"./svelte/svelte_store.js";import"./index-VELz1aW8.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";import"./MarkdownCode-DtcflbAZ.js";import"./prism-python-BAjd7o3F.js";function oe(s,r){const t=document.createElement("canvas").getContext("2d");t.fillStyle=s,t.fillRect(0,0,1,1);const[l,h,L]=t.getImageData(0,0,1,1).data;return`rgba(${l}, ${h}, ${L}, ${r})`}function Z(s){if(!s)return!0;const r=s.toLowerCase().trim();return r==="transparent"||r.length===9&&r.endsWith("00")}function Re(s,r){const v={};for(const t in s){const l=s[t].trim();l in ne?v[t]=ne[l]:Z(l)?v[t]={primary:"transparent",secondary:"transparent"}:v[t]={primary:r?oe(l,1):l,secondary:r?oe(l,.5):l}}return v}function ie(s,r){if(s.length===0)return[];const v=[];let t=s[0].token,l=s[0].class_or_confidence;for(let h=1;h<s.length;h++){const{token:L,class_or_confidence:f}=s[h];l===f?t+=L:(v.push({token:t,class_or_confidence:l}),t=L,l=f)}return v.push({token:t,class_or_confidence:l}),v}function ce(s){return s===null?"":s<0?`rgba(128, 90, 213, ${-s})`:`rgba(239, 68, 60, ${s})`}var Oe=e.from_html('<input class="label-input svelte-14ic1z3"/>');function se(s,r){e.push(r,!0);let v=e.prop(r,"value",31,()=>e.proxy([])),t=e.prop(r,"label_to_edit",31,()=>-1),l=e.prop(r,"is_scores_mode",3,!1),h=e.state(e.proxy(r.category?.toString()??""));function L(){if(l()){const c=typeof r.category=="number"?r.category:parseFloat(r.category??"0");return ce(c)}return r.category===null||r.active_legend&&r.active_legend!==r.category?"":r.color_map[r.category]?.primary??""}function f(c){const y=c.target.value.trim();v([...v().slice(0,r.label_index),{token:r.token,class_or_confidence:y===""?null:l()?Number(y):y},...v().slice(r.label_index+1)]),r.onchange()}function m(c){c.key==="Enter"&&(f(c),t(-1))}var o=Oe();e.remove_input_defaults(o),e.autofocus(o,!0),o.__input=c=>{e.set(h,c.target.value,!0)},o.__keydown=m;let u;e.template_effect(c=>{e.set_attribute(o,"type",l()?"number":"text"),e.set_attribute(o,"step",l()?"0.1":void 0),e.set_attribute(o,"placeholder",l()?void 0:"label"),e.set_value(o,r.category),u=e.set_style(o,"",u,c)},[()=>({"background-color":L(),width:l()?"7ch":`${(e.get(h)?.length||4)+4}ch`})]),e.event("blur",o,f),e.append(s,o),e.pop()}e.delegate(["input","keydown"]);var je=e.from_html('<button class="legend-item svelte-1akrbo3"> </button>'),ze=e.from_html('<div class="legend svelte-1akrbo3" data-testid="highlighted-text:category-legend"></div>'),Ce=e.from_html('<span class="label svelte-1akrbo3"> </span>'),He=e.from_html('<button class="remove-btn svelte-1akrbo3" aria-label="Remove label"><!></button>'),Te=e.from_html('<span class="token-container svelte-1akrbo3"><span><span> </span> <!> <!></span> <!></span>'),Ae=e.from_html('<span class="line-break svelte-1akrbo3"></span>'),Fe=e.from_html("<!> <!>",1),Ge=e.from_html('<!> <div class="textfield svelte-1akrbo3"></div>',1),Pe=e.from_html('<div class="score-legend svelte-1akrbo3" data-testid="highlighted-text:color-legend"><span>-1</span> <span>0</span> <span>+1</span></div>'),We=e.from_html('<button class="remove-btn svelte-1akrbo3" aria-label="Remove label"><!></button>'),qe=e.from_html('<span class="token-container svelte-1akrbo3"><span role="button"><span class="text svelte-1akrbo3"> </span> <!></span> <!></span>'),De=e.from_html('<!> <div class="textfield svelte-1akrbo3" data-testid="highlighted-text:textfield"></div>',1),Me=e.from_html('<div class="container svelte-1akrbo3"><!></div>');function Ne(s,r){e.push(r,!0);const v=typeof window<"u";let t=e.prop(r,"value",31,()=>e.proxy([])),l=e.prop(r,"show_legend",3,!1),h=e.prop(r,"show_inline_category",3,!0),L=e.prop(r,"color_map",19,()=>({})),f=e.prop(r,"interactive",3,!1),m=e.state(-1),o=e.state(""),u=e.state(-1),c=e.state(null),C=e.state("categories"),y=e.state(e.proxy({}));e.user_effect(()=>{let n={...L()};for(const g of t())g.class_or_confidence!==null&&(typeof g.class_or_confidence=="string"?(e.set(C,"categories"),g.class_or_confidence in n||(n[g.class_or_confidence]=ye(Object.keys(n).length))):e.set(C,"scores"));e.set(y,Re(n,v),!0)}),xe(()=>{if(!f())return;const n=()=>{e.set(c,window.getSelection(),!0),Q(),window.removeEventListener("mouseup",n)};window.addEventListener("mousedown",()=>{window.addEventListener("mouseup",n)})});function Q(){if(!e.get(c)||!e.get(c).toString().trim())return;const n=e.get(c).getRangeAt(0).startOffset,g=e.get(c).getRangeAt(0).endOffset;U(n,g)}function U(n,g){if(!e.get(c)?.toString()||e.get(m)===-1||!t()[e.get(m)].token.includes(e.get(c).toString()))return;const R=t()[e.get(m)].token,G=[{token:R.substring(0,n),class_or_confidence:null},{token:R.substring(n,g),class_or_confidence:e.get(C)==="scores"?1:"label"},{token:R.substring(g),class_or_confidence:null}].filter(O=>O.token.trim()!=="");t([...t().slice(0,e.get(m)),...G,...t().slice(e.get(m)+1)]),e.set(u,t().findIndex((O,x)=>x>=e.get(m)&&O.token===R.substring(n,g)&&O.class_or_confidence!==null),!0),A(),document.getElementById(`label-input-${e.get(u)}`)?.focus()}function q(n){n<0||n>=t().length||(t(t()[n].class_or_confidence=null,!0),t(ie(t())),A(),window.getSelection()?.empty())}function A(){r.onchange?.(t()),e.set(u,-1)}function p(n){return n===null||e.get(o)&&e.get(o)!==n?"":e.get(y)[n]?.secondary??""}function E(n){return n===null||e.get(o)&&e.get(o)!==n?"":e.get(y)[n]?.primary??""}function F(n){const g=p(n);return Z(g)?"":"black"}var D=Me(),de=e.child(D);{var ue=n=>{var g=Ge(),R=e.first_child(g);{var G=x=>{var S=ze();e.each(S,21,()=>Object.entries(e.get(y)),e.index,(i,I)=>{var a=e.derived(()=>e.to_array(e.get(I),2));let j=()=>e.get(a)[0],z=()=>e.get(a)[1];var d=je();let H;var T=e.child(d,!0);e.reset(d),e.template_effect(()=>{H=e.set_style(d,"",H,{"background-color":z().secondary}),e.set_text(T,j())}),e.event("mouseenter",d,()=>e.set(o,j(),!0)),e.event("mouseleave",d,()=>e.set(o,"")),e.event("focus",d,()=>e.set(o,j(),!0)),e.event("blur",d,()=>e.set(o,"")),e.append(i,d)}),e.reset(S),e.append(x,S)};e.if(R,x=>{l()&&x(G)})}var O=e.sibling(R,2);e.each(O,21,t,e.index,(x,S,i)=>{let I=()=>e.get(S).token,a=()=>e.get(S).class_or_confidence;const j=e.derived(()=>I().split(`
`));var z=e.comment(),d=e.first_child(z);e.each(d,17,()=>e.get(j),e.index,(H,T,P)=>{var M=Fe(),N=e.first_child(M);{var V=_=>{const w=e.derived(()=>p(a()));var W=Te(),B=e.child(W);let $;B.__click=()=>{a()!==null&&(f()?(r.onselect?.({index:i,value:[I(),a()]}),e.set(u,i,!0)):r.onselect?.({index:i,value:[I(),a()]}))},B.__keydown=b=>{f()&&b.key==="Enter"&&a()!==null&&e.set(u,i,!0)};let ee;var J=e.child(B);let te;var ge=e.child(J,!0);e.reset(J);var re=e.sibling(J,2);{var ve=b=>{var k=Ce();let K;var be=e.child(k,!0);e.reset(k),e.template_effect(ke=>{K=e.set_style(k,"",K,ke),e.set_text(be,a())},[()=>({"background-color":E(a())})]),e.append(b,k)};e.if(re,b=>{!l()&&h()&&a()!==null&&e.get(u)!==i&&b(ve)})}var fe=e.sibling(re,2);{var pe=b=>{se(b,{get category(){return a()},get active_legend(){return e.get(o)},get color_map(){return e.get(y)},label_index:i,get token(){return I()},onchange:A,get value(){return t()},set value(k){t(k)},get label_to_edit(){return e.get(u)},set label_to_edit(k){e.set(u,k,!0)}})};e.if(fe,b=>{f()&&e.get(u)===i&&a()!==null&&b(pe)})}e.reset(B);var he=e.sibling(B,2);{var me=b=>{var k=He();k.__click=()=>q(i);var K=e.child(k);ae(K),e.reset(k),e.append(b,k)};e.if(he,b=>{f()&&a()!==null&&b(me)})}e.reset(W),e.template_effect((b,k)=>{$=e.set_class(B,1,"token svelte-1akrbo3",null,$,b),e.set_attribute(B,"role",a()!==null?"button":void 0),e.set_attribute(B,"tabindex",a()!==null?0:void 0),ee=e.set_style(B,"",ee,k),te=e.set_class(J,1,"text svelte-1akrbo3",null,te,{unlabeled:a()===null}),e.set_text(ge,e.get(T))},[()=>({highlighted:a()!==null,transparent:a()!==null&&Z(e.get(w)),dimmed:e.get(o)&&e.get(o)!==a()}),()=>({"background-color":e.get(w),color:F(a())})]),e.event("focus",B,()=>e.set(m,i,!0)),e.event("mouseenter",B,()=>e.set(m,i,!0)),e.append(_,W)};e.if(N,_=>{e.get(T).trim()&&_(V)})}var X=e.sibling(N,2);{var Y=_=>{var w=Ae();e.append(_,w)};e.if(X,_=>{P<e.get(j).length-1&&_(Y)})}e.append(H,M)}),e.append(x,z)}),e.reset(O),e.append(n,g)},_e=n=>{var g=De(),R=e.first_child(g);{var G=x=>{var S=Pe();e.append(x,S)};e.if(R,x=>{l()&&x(G)})}var O=e.sibling(R,2);e.each(O,21,t,e.index,(x,S,i)=>{let I=()=>e.get(S).token,a=()=>e.get(S).class_or_confidence;const j=e.derived(()=>typeof a()=="string"?parseFloat(a()):a());var z=qe(),d=e.child(z);let H;e.set_attribute(d,"tabindex",0),d.__click=()=>{f()?e.set(u,i,!0):r.onselect?.({index:i,value:[I(),a()]})},d.__keydown=_=>{_.key==="Enter"&&(f()?e.set(u,i,!0):r.onselect?.({index:i,value:[I(),a()]}))};let T;var P=e.child(d),M=e.child(P,!0);e.reset(P);var N=e.sibling(P,2);{var V=_=>{se(_,{get category(){return a()},get active_legend(){return e.get(o)},get color_map(){return e.get(y)},label_index:i,get token(){return I()},onchange:A,is_scores_mode:!0,get value(){return t()},set value(w){t(w)},get label_to_edit(){return e.get(u)},set label_to_edit(w){e.set(u,w,!0)}})};e.if(N,_=>{f()&&a()!==null&&e.get(u)===i&&_(V)})}e.reset(d);var X=e.sibling(d,2);{var Y=_=>{var w=We();w.__click=()=>q(i);var W=e.child(w);ae(W),e.reset(w),e.append(_,w)};e.if(X,_=>{f()&&a()!==null&&e.get(m)===i&&_(Y)})}e.reset(z),e.template_effect(_=>{H=e.set_class(d,1,"token score-token svelte-1akrbo3",null,H,{highlighted:e.get(j)!==null}),T=e.set_style(d,"",T,_),e.set_text(M,I())},[()=>({"background-color":ce(e.get(j))})]),e.event("mouseenter",d,()=>e.set(m,i,!0)),e.event("focus",d,()=>e.set(m,i,!0)),e.append(x,z)}),e.reset(O),e.append(n,g)};e.if(de,n=>{e.get(C)==="categories"?n(ue):n(_e,!1)})}e.reset(D),e.append(s,D),e.pop()}e.delegate(["click","keydown"]);var Je=e.from_html("<!> <!> <!> <!>",1);function pt(s,r){e.push(r,!0);const v=e.rest_props(r,["$$slots","$$events","$$legacy"]),t=new Be(v);let l=e.state(e.proxy(t.props.value));e.user_effect(()=>{e.get(l)!==t.props.value&&(e.set(l,t.props.value,!0),t.dispatch("change"))});let h=e.derived(()=>t.props.combine_adjacent?ie(t.props.value||[]):t.props.value);{let L=e.derived(()=>t.shared.interactive?"dashed":"solid");we(s,{get variant(){return e.get(L)},test_id:"highlighted-text",get visible(){return t.shared.visible},get elem_id(){return t.shared.elem_id},get elem_classes(){return t.shared.elem_classes},padding:!1,get container(){return t.shared.container},get scale(){return t.shared.scale},get min_width(){return t.shared.min_width},get rtl(){return t.props.rtl},children:(f,m)=>{var o=Je(),u=e.first_child(o);Le(u,e.spread_props({get autoscroll(){return t.shared.autoscroll},get i18n(){return t.i18n}},()=>t.shared.loading_status,{onclearstatus:()=>t.dispatch("clear_status",t.shared.loading_status)}));var c=e.sibling(u,2);{var C=p=>{Ee(p,{get buttons(){return t.props.buttons},on_custom_button_click:E=>t.dispatch("custom_button_click",{id:E})})};e.if(c,p=>{t.shared.interactive&&t.shared.label&&t.shared.show_label&&t.props.buttons?.length&&p(C)})}var y=e.sibling(c,2);{var Q=p=>{{let E=e.derived(()=>t.shared.label||t.i18n("highlighted_text.highlighted_text")),F=e.derived(()=>t.shared.container===!1);Se(p,{get Icon(){return le},get label(){return e.get(E)},float:!1,get disable(){return e.get(F)},get show_label(){return t.shared.show_label},get rtl(){return t.props.rtl}})}};e.if(y,p=>{t.shared.label&&t.shared.show_label&&p(Q)})}var U=e.sibling(y,2);{var q=p=>{Ne(p,{get interactive(){return t.shared.interactive},get show_legend(){return t.props.show_legend},get show_inline_category(){return t.props.show_inline_category},get color_map(){return t.props.color_map},onselect:E=>t.dispatch("select",E),onchange:()=>{t.props.value=e.get(h),t.dispatch("change")},get value(){return e.get(h)},set value(E){e.set(h,E)}})},A=p=>{{let E=e.derived(()=>t.shared.interactive?"small":"large");Ie(p,{get size(){return e.get(E)},get unpadded_box(){return t.shared.interactive},children:(F,D)=>{le(F)},$$slots:{default:!0}})}};e.if(U,p=>{e.get(h)?p(q):p(A,!1)})}e.append(f,o)},$$slots:{default:!0}})}e.pop()}export{Ne as BaseHighlightedText,pt as default};
