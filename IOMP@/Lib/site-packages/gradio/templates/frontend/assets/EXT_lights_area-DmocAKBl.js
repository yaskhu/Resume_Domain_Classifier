import{d as L,aI as m,T as u,L as w,V as n,an as R,_ as b,s as E,R as D,C as y,bh as S,ao as B,aG as z,aH as F}from"./index-WPyB0dpY.js";import{R as x}from"./rawTexture-Bg4I7d5Y.js";import{ArrayItem as A,GLTFLoader as C}from"./glTFLoader-BEfLAtlo.js";import"./index-VELz1aW8.js";import"./svelte/svelte_svelte.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_client.js";import"./svelte/svelte_internal_flags_async.js";import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";import"./bone-CoxiKvzQ.js";import"./skeleton-ByQ-bour.js";import"./assetContainer-CH9OIjaK.js";import"./objectModelMapping-B0ewMN_K.js";async function M(){const i=new Uint16Array(16384),t=new Uint16Array(4096*4),r=await L.LoadFileAsync(L.GetAssetUrl("https://assets.babylonjs.com/core/areaLights/areaLightsLTC.bin")),e=new Uint16Array(r),a=e.length/8;for(let s=0;s<a;s++)i[s*4]=e[s*8],i[s*4+1]=e[s*8+1],i[s*4+2]=e[s*8+2],i[s*4+3]=e[s*8+3],t[s*4]=e[s*8+4],t[s*4+1]=e[s*8+5],t[s*4+2]=e[s*8+6],t[s*4+3]=e[s*8+7];return[i,t]}function P(i){const t=i.useDelayedTextureLoading;i.useDelayedTextureLoading=!1;const r=i._blockEntityCollection;i._blockEntityCollection=!1,i._ltcTextures={LTC1:x.CreateRGBATexture(null,64,64,i.getEngine(),!1,!1,2,2,0,!1,!0),LTC2:x.CreateRGBATexture(null,64,64,i.getEngine(),!1,!1,2,2,0,!1,!0)},i._blockEntityCollection=r,i._ltcTextures.LTC1.wrapU=u.CLAMP_ADDRESSMODE,i._ltcTextures.LTC1.wrapV=u.CLAMP_ADDRESSMODE,i._ltcTextures.LTC2.wrapU=u.CLAMP_ADDRESSMODE,i._ltcTextures.LTC2.wrapV=u.CLAMP_ADDRESSMODE,i.useDelayedTextureLoading=t,M().then(e=>{i._ltcTextures&&((i._ltcTextures?.LTC1).update(e[0]),(i._ltcTextures?.LTC2).update(e[1]),i.onDisposeObservable.addOnce(()=>{i._ltcTextures?.LTC1.dispose(),i._ltcTextures?.LTC2.dispose()}))}).catch(e=>{w.Error(`Area Light fail to get LTC textures data. Error: ${e}`)})}class U extends m{constructor(t,r,e,a){super(t,e,a),this.position=r,this._scene._ltcTextures||P(this._scene)}transferTexturesToEffect(t){return this._scene._ltcTextures&&(t.setTexture("areaLightsLTC1Sampler",this._scene._ltcTextures.LTC1),t.setTexture("areaLightsLTC2Sampler",this._scene._ltcTextures.LTC2)),this}prepareLightSpecificDefines(t,r){t["AREALIGHT"+r]=!0,t.AREALIGHTUSED=!0}_isReady(){return this._scene._ltcTextures?this._scene._ltcTextures.LTC1.isReady()&&this._scene._ltcTextures.LTC2.isReady():!1}}R.AddNodeConstructor("Light_Type_4",(i,t)=>()=>new l(i,n.Zero(),1,1,t));class l extends U{get width(){return this._width.x}set width(t){this._width.x=t}get height(){return this._height.y}set height(t){this._height.y=t}constructor(t,r,e,a,s,f){super(t,r,s,f),this._width=new n(e,0,0),this._height=new n(0,a,0),this._pointTransformedPosition=n.Zero(),this._pointTransformedWidth=n.Zero(),this._pointTransformedHeight=n.Zero()}getClassName(){return"RectAreaLight"}getTypeID(){return m.LIGHTTYPEID_RECT_AREALIGHT}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightWidth",4),this._uniformBuffer.addUniform("vLightHeight",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeTransformedInformation(){return this.parent&&this.parent.getWorldMatrix?(n.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this._pointTransformedPosition),n.TransformNormalToRef(this._width,this.parent.getWorldMatrix(),this._pointTransformedWidth),n.TransformNormalToRef(this._height,this.parent.getWorldMatrix(),this._pointTransformedHeight),!0):!1}transferToEffect(t,r){const e=this._scene.floatingOriginOffset;return this._computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this._pointTransformedPosition.x-e.x,this._pointTransformedPosition.y-e.y,this._pointTransformedPosition.z-e.z,0,r),this._uniformBuffer.updateFloat4("vLightWidth",this._pointTransformedWidth.x/2,this._pointTransformedWidth.y/2,this._pointTransformedWidth.z/2,0,r),this._uniformBuffer.updateFloat4("vLightHeight",this._pointTransformedHeight.x/2,this._pointTransformedHeight.y/2,this._pointTransformedHeight.z/2,0,r)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x-e.x,this.position.y-e.y,this.position.z-e.z,0,r),this._uniformBuffer.updateFloat4("vLightWidth",this._width.x/2,this._width.y/2,this._width.z/2,0,r),this._uniformBuffer.updateFloat4("vLightHeight",this._height.x/2,this._height.y/2,this._height.z/2,0,r)),this}transferToNodeMaterialEffect(t,r){const e=this._scene.floatingOriginOffset;return this._computeTransformedInformation()?t.setFloat3(r,this._pointTransformedPosition.x-e.x,this._pointTransformedPosition.y-e.y,this._pointTransformedPosition.z-e.z):t.setFloat3(r,this.position.x-e.x,this.position.y-e.y,this.position.z-e.z),this}}b([E()],l.prototype,"width",null);b([E()],l.prototype,"height",null);D("BABYLON.RectAreaLight",l);const c="EXT_lights_area";class v{constructor(t){this.name=c,this._loader=t,this.enabled=this._loader.isExtensionUsed(c)}dispose(){this._loader=null,delete this._lights}onLoading(){const t=this._loader.gltf.extensions;if(t&&t[this.name]){const r=t[this.name];this._lights=r.lights,A.Assign(this._lights)}}loadNodeAsync(t,r,e){return C.LoadExtensionAsync(t,r,this.name,async(a,s)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(t,r,f=>{let h;const o=A.Get(a,this._lights,s.light),p=o.name||f.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer;const d=o.size!==void 0?o.size:1;switch(o.type){case"rect":{const _=o.rect?.aspect!==void 0?o.rect.aspect*d:d,g=d;h=new l(p,n.Zero(),_,g,this._loader.babylonScene);break}case"disk":{const _=Math.sqrt(d*d*.25*Math.PI);h=new l(p,n.Zero(),_,_,this._loader.babylonScene);break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${a}: Invalid area light type (${o.type})`)}h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=h,h.falloffType=m.FALLOFF_GLTF,h.diffuse=o.color?y.FromArray(o.color):y.White(),h.intensity=o.intensity==null?1:o.intensity;const T=new S(`${p}_orientation`,this._loader.babylonScene);T.rotationQuaternion=B.RotationAxis(n.Up(),Math.PI),T.parent=f,h.parent=T,this._loader._babylonLights.push(h),C.AddPointerMetadata(h,a),e(f)})))}}z(c);F(c,!0,i=>new v(i));export{v as EXT_lights_area};
