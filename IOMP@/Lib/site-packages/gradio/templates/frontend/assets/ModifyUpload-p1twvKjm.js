import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{onMount as ne,onDestroy as ie,tick as le}from"./svelte/svelte_svelte.js";import{p as oe}from"./index-VELz1aW8.js";import{e as se,I as S,p as de,y as fe,i as ue,n as ce,D as _e}from"./ScrollFade-YiJdnYV-.js";import"./svelte/svelte_internal_flags_legacy.js";import"./i18n-IeFj-zpk.js";var ge=e.from_html('<div class="file svelte-ua961l"><span><div class="progress-bar svelte-ua961l"><progress style="visibility:hidden;height:0;width:0;" max="100" class="svelte-ua961l"> </progress></div></span> <span class="file-name svelte-ua961l"> </span></div>'),pe=e.from_html('<div><span class="uploading svelte-ua961l"> </span> <!></div>');function ve(o,t){e.push(t,!0);let s,w=e.state(!1),d=e.state(void 0),_=e.derived(()=>e.get(d)||e.get(m)[0]),m=e.state(e.proxy(t.files.map(f=>({...f,progress:0}))));function x(f,a){e.set(m,e.get(m).map(u=>(u.orig_name===f&&(u.progress+=a),u)),!0)}function h(f){return f.progress*100/(f.size||0)||0}ne(async()=>{if(s=await t.stream_handler(new URL(`${t.root}/gradio_api/upload_progress?upload_id=${t.upload_id}`)),s==null)throw new Error("Event source is not defined");s.onmessage=async function(f){const a=JSON.parse(f.data);e.get(w)||e.set(w,!0),a.msg==="done"?(s?.close(),t.ondone?.()):(e.set(d,a,!0),x(a.orig_name,a.chunk_size))}}),ie(()=>{(s!=null||s!=null)&&s.close()});function b(f){let a=0;return f.forEach(u=>{a+=h(u)}),document.documentElement.style.setProperty("--upload-progress-width",(a/f.length).toFixed(2)+"%"),a/f.length}e.user_effect(()=>{b(e.get(m))});var v=pe();let i;var y=e.child(v),k=e.child(y);e.reset(y);var D=e.sibling(y,2);{var F=f=>{var a=ge(),u=e.child(a),A=e.child(u),W=e.child(A),C=e.child(W,!0);e.reset(W),e.reset(A),e.reset(u);var T=e.sibling(u,2),P=e.child(T,!0);e.reset(T),e.reset(a),e.template_effect((M,N)=>{e.set_value(W,M),e.set_text(C,N),e.set_text(P,e.get(_).orig_name)},[()=>h(e.get(_)),()=>h(e.get(_))]),e.append(f,a)};e.if(D,f=>{e.get(_)&&f(F)})}e.reset(v),e.template_effect(()=>{i=e.set_class(v,1,"wrap svelte-ua961l",null,i,{progress:e.get(w)}),e.set_text(k,`Uploading ${e.get(m).length??""}
		${e.get(m).length>1?"files":"file"}...`)}),e.append(o,v),e.pop()}function me(){let o,t;return{drag(s,w={}){t=w;function d(){o=document.createElement("input"),o.type="file",o.style.display="none",o.setAttribute("aria-label","File upload"),o.setAttribute("data-testid","file-upload");const i=Array.isArray(t.accepted_types)?t.accepted_types.join(","):t.accepted_types||void 0;i&&(o.accept=i),o.multiple=t.mode==="multiple"||!1,t.mode==="directory"&&(o.webkitdirectory=!0,o.setAttribute("directory",""),o.setAttribute("mozdirectory","")),s.appendChild(o)}d();function _(i){i.preventDefault(),i.stopPropagation()}function m(i){i.preventDefault(),i.stopPropagation(),t.on_drag_change?.(!0)}function x(i){i.preventDefault(),i.stopPropagation(),t.on_drag_change?.(!1)}function h(i){if(i.preventDefault(),i.stopPropagation(),t.on_drag_change?.(!1),!i.dataTransfer?.files)return;const y=Array.from(i.dataTransfer.files);y.length>0&&t.on_files?.(y)}function b(){t.disable_click||(o.value="",o.click())}function v(){if(o.files){const i=Array.from(o.files);i.length>0&&t.on_files?.(i)}}return s.addEventListener("drag",_),s.addEventListener("dragstart",_),s.addEventListener("dragend",_),s.addEventListener("dragover",_),s.addEventListener("dragenter",m),s.addEventListener("dragleave",x),s.addEventListener("drop",h),s.addEventListener("click",b),o.addEventListener("change",v),{update(i){t=i,o.remove(),d(),o.addEventListener("change",v)},destroy(){s.removeEventListener("drag",_),s.removeEventListener("dragstart",_),s.removeEventListener("dragend",_),s.removeEventListener("dragover",_),s.removeEventListener("dragenter",m),s.removeEventListener("dragleave",x),s.removeEventListener("drop",h),s.removeEventListener("click",b),o.removeEventListener("change",v),o.remove()}}},open_file_upload(){o&&(o.value="",o.click())}}}var he=e.from_html("<button><!></button>"),ye=e.from_html('<button aria-dropeffect="copy"><!></button>');function Pe(o,t){e.push(t,!0);const{drag:s,open_file_upload:w}=me();let d=e.prop(t,"filetype",3,null),_=e.prop(t,"dragging",15,!1),m=e.prop(t,"boundedheight",3,!0),x=e.prop(t,"center",3,!0),h=e.prop(t,"flex",3,!0),b=e.prop(t,"file_count",3,"single"),v=e.prop(t,"disable_click",3,!1),i=e.prop(t,"hidden",3,!1),y=e.prop(t,"format",3,"file"),k=e.prop(t,"uploading",15,!1),D=e.prop(t,"show_progress",3,!0),F=e.prop(t,"max_file_size",3,null),f=e.prop(t,"icon_upload",3,!1),a=e.prop(t,"height",3,void 0),u=e.prop(t,"aria_label",3,void 0),A=e.prop(t,"upload_promise",15);function W(){w()}let C="",T,P=e.state(null),M=null,O=(()=>{if(typeof navigator<"u"){const r=navigator.userAgent.toLowerCase();return r.indexOf("iphone")>-1||r.indexOf("ipad")>-1}return!1})();const H=["image","video","audio","text","file"],J=r=>O&&r.startsWith(".")?(M=!0,r):O&&r.includes("file/*")?"*":r.startsWith(".")||r.endsWith("/*")?r:H.includes(r)?r+"/*":"."+r;e.user_effect(()=>{if(d()==null)e.set(P,null);else if(typeof d()=="string")e.set(P,J(d()),!0);else if(O&&d().includes("file/*"))e.set(P,"*");else{const r=d().map(J);e.set(P,r.join(", "),!0)}});function R(){navigator.clipboard.read().then(async r=>{for(let l=0;l<r.length;l++){const c=r[l].types.find(n=>n.startsWith("image/"));if(c){r[l].getType(c).then(async n=>{const p=new File([n],`clipboard.${c.replace("image/","")}`);await j([p])});break}}})}function K(){w()}async function Q(r,l){return l?C=l:C=Math.random().toString(36).substring(2,15),await le(),k(!0),A(new Promise(async c=>{try{const n=await t.upload(r,t.root,C,F()??1/0);t.onload?.(b()==="single"?n?.[0]:n),c(n||[]),k(!1)}catch(n){t.onerror?.(n.message),k(!1),c([])}})),A()}function V(r,l,c){if(!r||r==="*"||r==="file/*"||Array.isArray(r)&&r.some(p=>p==="*"||p==="file/*"))return!0;let n;if(typeof r=="string")n=r.split(",").map(p=>p.trim());else if(Array.isArray(r))n=r;else return!1;return n.includes(l)||n.some(p=>{const[E]=p.split("/").map(g=>g.trim());return p.endsWith("/*")&&c.startsWith(E+"/")})}async function j(r,l){if(!r.length)return;let c=r.map(n=>new File([n],n instanceof File?n.name:"file",{type:n.type}));return O&&M&&(c=c.filter(n=>q(n)?!0:(t.onerror?.(`Invalid file type: ${n.name}. Only ${d()} allowed.`),!1)),c.length===0)?[]:(T=await oe(c),await Q(T,l))}function q(r){return d()?(Array.isArray(d())?d():[d()]).some(c=>{const n=J(c);if(n.startsWith("."))return r.name.toLowerCase().endsWith(n.toLowerCase());if(n==="*")return!0;if(n.endsWith("/*")){const[p]=n.split("/");return r.type.startsWith(p+"/")}return r.type===n}):!0}async function X(r){const l=r.filter(c=>{const n="."+c.name.toLowerCase().split(".").pop();return n&&V(e.get(P),n,c.type)||(n&&Array.isArray(d())?d().includes(n):n===d())?!0:(t.onerror?.(`Invalid file type only ${d()} allowed.`),!1)});if(y()!="blob")await j(l);else{if(b()==="single"){t.onload?.(l[0]);return}t.onload?.(l)}}async function Y(r){if(_(!1),!r.dataTransfer?.files)return;const l=Array.from(r.dataTransfer.files).filter(q);if(y()!="blob")await j(l);else{if(b()==="single"){t.onload?.(l[0]);return}t.onload?.(l)}}var Z={open_upload:W,paste_clipboard:R,open_file_upload:K,load_files:j,load_files_from_drop:Y},G=e.comment(),$=e.first_child(G);{var ee=r=>{var l=he();l.__click=R;let c,n;var p=e.child(l);{var E=g=>{var I=e.comment(),U=e.first_child(I);e.snippet(U,()=>t.children),e.append(g,I)};e.if(p,g=>{t.children&&g(E)})}e.reset(l),e.template_effect(()=>{e.set_attribute(l,"tabindex",i()?-1:0),e.set_attribute(l,"aria-label",u()||"Paste from clipboard"),c=e.set_class(l,1,"svelte-8prmba",null,c,{hidden:i(),center:x(),boundedheight:m(),flex:h(),"icon-mode":f()}),n=e.set_style(l,"",n,{height:f()?"":a()?typeof a()=="number"?a()+"px":a():"100%"})}),e.append(r,l)},te=r=>{var l=e.comment(),c=e.first_child(l);{var n=E=>{var g=e.comment(),I=e.first_child(g);{var U=z=>{ve(z,{get root(){return t.root},get upload_id(){return C},get files(){return T},get stream_handler(){return t.stream_handler}})};e.if(I,z=>{i()||z(U)})}e.append(E,g)},p=E=>{var g=ye();let I,U;var z=e.child(g);{var re=L=>{var B=e.comment(),ae=e.first_child(B);e.snippet(ae,()=>t.children),e.append(L,B)};e.if(z,L=>{t.children&&L(re)})}e.reset(g),e.action(g,(L,B)=>s?.(L,B),()=>({on_drag_change:L=>_(L),on_files:L=>X(L),accepted_types:e.get(P),mode:b(),disable_click:v()})),e.template_effect(()=>{e.set_attribute(g,"tabindex",i()?-1:0),e.set_attribute(g,"aria-label",u()||"Click to upload or drop files"),I=e.set_class(g,1,"svelte-8prmba",null,I,{hidden:i(),center:x(),boundedheight:m(),flex:h(),disable_click:v(),"icon-mode":f()}),U=e.set_style(g,"",U,{height:f()?"":a()?typeof a()=="number"?a()+"px":a():"100%"})}),e.append(E,g)};e.if(c,E=>{k()&&D()?E(n):E(p,!1)},!0)}e.append(r,l)};e.if($,r=>{d()==="clipboard"?r(ee):r(te,!1)})}return e.append(o,G),e.pop(Z)}e.delegate(["click"]);var be=e.from_html("<!> <!> <!> <!> <!>",1);function We(o,t){e.push(t,!0);let s=e.prop(t,"editable",3,!1),w=e.prop(t,"undoable",3,!1),d=e.prop(t,"download",3,null);se(o,{children:(_,m)=>{var x=be(),h=e.first_child(x);{var b=a=>{{let u=e.derived(()=>t.i18n("common.edit"));S(a,{get Icon(){return fe},get label(){return e.get(u)},onclick:()=>t.onedit?.()})}};e.if(h,a=>{s()&&a(b)})}var v=e.sibling(h,2);{var i=a=>{{let u=e.derived(()=>t.i18n("common.undo"));S(a,{get Icon(){return ue},get label(){return e.get(u)},onclick:()=>t.onundo?.()})}};e.if(v,a=>{w()&&a(i)})}var y=e.sibling(v,2);{var k=a=>{ce(a,{get href(){return d()},download:!0,children:(u,A)=>{{let W=e.derived(()=>t.i18n("common.download"));S(u,{get Icon(){return _e},get label(){return e.get(W)}})}},$$slots:{default:!0}})};e.if(y,a=>{d()&&a(k)})}var D=e.sibling(y,2);{var F=a=>{var u=e.comment(),A=e.first_child(u);e.snippet(A,()=>t.children),e.append(a,u)};e.if(D,a=>{t.children&&a(F)})}var f=e.sibling(D,2);{let a=e.derived(()=>t.i18n("common.clear"));S(f,{get Icon(){return de},get label(){return e.get(a)},onclick:u=>{t.onclear?.(),u.stopPropagation()}})}e.append(_,x)},$$slots:{default:!0}}),e.pop()}export{We as M,Pe as U,ve as a,me as c};
