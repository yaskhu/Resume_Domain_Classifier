import"./svelte/svelte_internal_flags_async.js";import*as t from"./svelte/svelte_internal_client.js";import{tick as C}from"./svelte/svelte_svelte.js";import{B as J,U as K,S as M}from"./ScrollFade-YiJdnYV-.js";import"./svelte/svelte_internal_flags_legacy.js";import"./i18n-IeFj-zpk.js";import{G as O}from"./utils.svelte-NGrRZh7a.js";import{G as Q,h as F}from"./Gallery-B5nvLLlY.js";import{S as V}from"./StreamingBar-CdRfiLdf.js";import{BaseFileUpload as X}from"./Index-C70ak2QL.js";import{Webcam as P}from"./Index-BBQHPdoo.js";import{default as qe}from"./Example-CR6Oggaq.js";import"./MarkdownCode-DtcflbAZ.js";import"./index-VELz1aW8.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";import"./prism-python-BAjd7o3F.js";import"./ShareButton-CzqLPjdz.js";import"./FullscreenButton-Bk-YQzX_.js";import"./ModifyUpload-p1twvKjm.js";import"./Image-Bdf4wQSw.js";import"./ImagePreview-C_QdZHnm.js";import"./Video-DZ7QGqqT.js";import"./index-tFQomdd2.js";import"./Example-CPmG5Ezd.js";import"./Example-1lv5JGKJ.js";var Y=t.from_html("<div><!></div> <!> <!>",1),Z=t.from_html("<!> <!>",1);function je(W,c){t.push(c,!0);let v=t.state(void 0);class j extends O{async get_data(){return t.get(v)&&(await t.get(v),await C()),await super.get_data()}}const I=t.rest_props(c,["$$slots","$$events","$$legacy"]),e=new j(I,{selected_index:null,file_types:["image","video"]});let b=t.state(!1);function T(l){if(!e.props.value)return;const{index:n}=l.detail;e.dispatch("delete",l.detail),e.props.value=e.props.value.filter((s,p)=>p!==n),e.dispatch("change",e.props.value)}async function g(l){return(await Promise.all(l.map(async s=>{if(s.path?.toLowerCase().endsWith(".svg")&&s.url){const u=await(await fetch(s.url)).text();return{...s,url:`data:image/svg+xml,${encodeURIComponent(u)}`}}return s}))).map(s=>s.mime_type?.includes("video")?{video:s,caption:null}:{image:s,caption:null})}let S,i=t.state(t.proxy(e.props.sources?e.props.sources[0]:"upload")),U=t.derived(()=>e.props.value===null?!0:e.props.value.length===0),w=t.derived(()=>e.props.file_types?.includes("video")&&e.props.sources.includes("webcam")?e.props.sources.concat(["webcam-video"]):e.props.sources);async function z(){navigator.clipboard.read().then(async l=>{let n=null;for(let s=0;s<l.length;s++){const p=l[s].types.find(u=>(e.props.file_types||["image"]).some(x=>u.startsWith(x+"/")));if(p){const u=await l[s].getType(p);n=new File([u],`clipboard.${p.replace("image/","")}`);break}}if(n){const s=await F(n,u=>e.shared.client.upload(u,e.shared.root),"clipboard_upload"),p=await g(s);e.props.value?.push(...p),e.dispatch("change",e.props.value),t.set(i,null)}else e.dispatch("warning","No image or video found in clipboard")})}async function q(l){l==="clipboard"&&await z()}async function E(l){await C(),l==="clipboard"?await z():(t.set(i,l,!0),t.set(U,!0))}{let l=t.derived(()=>typeof e.props.height=="number"?e.props.height:void 0);J(W,{get visible(){return e.shared.visible},variant:"solid",padding:!1,get elem_id(){return e.shared.elem_id},get elem_classes(){return e.shared.elem_classes},get container(){return e.shared.container},get scale(){return e.shared.scale},get min_width(){return e.shared.min_width},allow_overflow:!1,get height(){return t.get(l)},get fullscreen(){return t.get(b)},set fullscreen(n){t.set(b,n,!0)},children:(n,s)=>{var p=Z(),u=t.first_child(p);V(u,t.spread_props({get autoscroll(){return e.shared.autoscroll},get i18n(){return e.i18n}},()=>e.shared.loading_status,{on_clear_status:()=>e.dispatch("clear_status",e.shared.loading_status)}));var x=t.sibling(u,2);{var L=h=>{var y=Y(),_=t.first_child(y),G=t.child(_);t.bind_this(X(G,{value:null,get root(){return e.shared.root},get label(){return e.shared.label},get max_file_size(){return e.shared.max_file_size},file_count:"multiple",get file_types(){return e.props.file_types},get i18n(){return e.i18n},upload:(...a)=>e.shared.client.upload(...a),stream_handler:(...a)=>e.shared.client.stream(...a),onupload:async a=>{const o=Array.isArray(a)?a:[a];e.props.value=await g(o),t.set(i,null),e.dispatch("upload",e.props.value),e.dispatch("change",e.props.value)},onerror:({detail:a})=>{e.shared.loading_status=e.shared.loading_status||{},e.shared.loading_status.status="error",e.dispatch("error",a)},get upload_promise(){return t.get(v)},set upload_promise(a){t.set(v,a,!0)},children:(a,o)=>{K(a,{get i18n(){return e.i18n},type:"gallery"})},$$slots:{default:!0}}),a=>S=a,()=>S),t.reset(_);var r=t.sibling(_,2);{var $=a=>{P(a,{get root(){return e.shared.root},value:null,mirror_webcam:!0,streaming:!1,mode:"image",include_audio:!1,get i18n(){return e.i18n},upload:(...o)=>e.shared.client.upload(...o),$$events:{capture:async o=>{const k=await F(o.detail,f=>e.shared.client.upload(f,e.shared.root),"webcam_upload"),B=await g(k);e.props.value?.push(...B),t.set(i,null),e.dispatch("change",e.props.value)},error(o){t.bubble_event.call(this,c,o)},drag(o){t.bubble_event.call(this,c,o)},close_stream(o){t.bubble_event.call(this,c,o)}}})},m=a=>{var o=t.comment(),k=t.first_child(o);{var B=f=>{P(f,{get root(){return e.shared.root},value:null,mirror_webcam:!0,streaming:!1,mode:"video",include_audio:!1,get i18n(){return e.i18n},upload:(...d)=>e.shared.client.upload(...d),$$events:{capture:async d=>{const A={...d.detail};A.mime_type="video/webm";const H=await g([A]);e.props.value?.push(...H),t.set(i,null),e.dispatch("change",e.props.value)},error(d){t.bubble_event.call(this,c,d)},drag(d){t.bubble_event.call(this,c,d)},close_stream(d){t.bubble_event.call(this,c,d)}}})};t.if(k,f=>{t.get(i)==="webcam-video"&&f(B)},!0)}t.append(a,o)};t.if(r,a=>{t.get(i)==="webcam"?a($):a(m,!1)})}var R=t.sibling(r,2);{var D=a=>{M(a,{get sources(){return t.get(w)},handle_clear:()=>e.dispatch("clear"),handle_select:q,get active_source(){return t.get(i)},set active_source(o){t.set(i,o,!0)}})};t.if(R,a=>{(t.get(w).length>1||t.get(w).includes("clipboard"))&&a(D)})}t.template_effect(a=>t.set_class(_,1,a,"svelte-vrqwbn"),[()=>t.clsx(!e.props.value||t.get(i)&&t.get(i).includes("webcam")?"hidden-upload-input":"")]),t.append(h,y)},N=h=>{{let y=t.derived(()=>e.props.buttons.some(r=>typeof r=="string"&&r==="share")),_=t.derived(()=>e.props.buttons.some(r=>typeof r=="string"&&r==="download")),G=t.derived(()=>e.props.buttons.some(r=>typeof r=="string"&&r==="fullscreen"));Q(h,{onchange:()=>e.dispatch("change"),onclear:()=>e.dispatch("change"),onselect:r=>e.dispatch("select",r),onshare:r=>e.dispatch("share",r.detail),onerror:r=>e.dispatch("error",r.detail),onpreview_open:()=>{e.dispatch("preview_open")},onpreview_close:()=>e.dispatch("preview_close"),onfullscreen:({detail:r})=>{t.set(b,r,!0)},ondelete:T,onupload:async r=>{const $=Array.isArray(r)?r:[r],m=await g($);e.props.value=e.props.value?[...e.props.value,...m]:m,e.dispatch("upload",m),e.dispatch("change",e.props.value)},get sources(){return t.get(w)},onsource_change:E,get label(){return e.shared.label},get show_label(){return e.shared.show_label},get columns(){return e.props.columns},get rows(){return e.props.rows},get height(){return e.props.height},get preview(){return e.props.preview},get object_fit(){return e.props.object_fit},get interactive(){return e.shared.interactive},get allow_preview(){return e.props.allow_preview},get show_share_button(){return t.get(y)},get show_download_button(){return t.get(_)},get fit_columns(){return e.props.fit_columns},get i18n(){return e.i18n},_fetch:(...r)=>e.shared.client.fetch(...r),get show_fullscreen_button(){return t.get(G)},get buttons(){return e.props.buttons},on_custom_button_click:r=>{e.dispatch("custom_button_click",{id:r})},get fullscreen(){return t.get(b)},get root(){return e.shared.root},get file_types(){return e.props.file_types},get max_file_size(){return e.shared.max_file_size},upload:(...r)=>e.shared.client.upload(...r),stream_handler:(...r)=>e.shared.client.stream(...r),get selected_index(){return e.props.selected_index},set selected_index(r){e.props.selected_index=r},get value(){return e.props.value},set value(r){e.props.value=r}})}};t.if(x,h=>{e.shared.interactive&&t.get(U)?h(L):h(N,!1)})}t.append(n,p)},$$slots:{default:!0}})}t.pop()}export{qe as BaseExample,Q as BaseGallery,je as default};
